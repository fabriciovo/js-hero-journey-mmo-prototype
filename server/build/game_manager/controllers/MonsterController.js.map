{"version":3,"file":"MonsterController.js","names":["_MonsterModel","_interopRequireDefault","require","enemyData","_interopRequireWildcard","_uuid","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","MonsterController","exports","io","locations","_classCallCheck2","monsters","monsterLocations","setupSpawn","init","_createClass2","key","value","update","setupEventListeners","socket","_this","on","monsterId","playerAttack","playerId","monster","exp","playerAttackValue","loseHealth","health","emit","deleteMonster","id","_this2","setInterval","keys","forEach","_movement","_this3","length","spawnMonster","pickRandomLocation","location","Math","floor","random","invalidLocation","some","obj","x","y","randomEnemy","enemies","MonsterModel","goldValue","concat","v4","healthValue","attackValue","expValue","addMonster","addLocation","push","getMonsterList","getMonster","getMonsterLocationList","move"],"sources":["../../../src/game_manager/controllers/MonsterController.js"],"sourcesContent":["import MonsterModel from \"../../models/MonsterModel\";\nimport * as enemyData from \"../../../public/assets/Enemies/enemies.json\";\nimport { v4 } from \"uuid\";\n\nexport default class MonsterController {\n  constructor(io, locations) {\n    this.monsters = {};\n    this.monsterLocations = locations;\n    this.io = io;\n\n    this.setupSpawn();\n    this.init();\n  }\n\n  init() {\n    this.update();\n  }\n\n  setupEventListeners(socket) {\n    return socket.on(\"monsterHit\", (monsterId, playerAttack, playerId) => {\n      if (!this.monsters[monsterId]) return;\n      const monster = this.monsters[monsterId];\n      const { exp } = monster;\n      const playerAttackValue = playerAttack;\n      monster.loseHealth(playerAttackValue);\n\n      if (monster.health <= 0) {\n        socket.emit(\"playerUpdateXp\", playerId, exp);\n\n        this.deleteMonster(monster.id);\n      } else {\n        socket.emit(\"updateMonsterHealth\", monsterId, monster.health);\n      }\n    });\n  }\n\n  update() {\n    setInterval(() => {\n      Object.keys(this.monsters).forEach((id) => {\n        if (!this.monsters[id]) return;\n        this._movement(this.monsters[id]);\n      });\n    }, 1000);\n  }\n\n  setupSpawn() {\n    setInterval(() => {\n      if (Object.keys(this.monsters).length <= 8) {\n        this.spawnMonster();\n      }\n    }, 3000);\n  }\n\n  pickRandomLocation() {\n    const location =\n      this.monsterLocations[\n        Math.floor(Math.random() * this.monsterLocations.length)\n      ];\n\n    if (this.monsters.length > 0) {\n      const invalidLocation = this.monsters.some((obj) => {\n        if (obj.x === location[0] && obj.y === location[1]) {\n          return true;\n        }\n        return false;\n      });\n\n      if (invalidLocation) return this.pickRandomLocation();\n      return location || [200, 200];\n    }\n    return location || [200, 200];\n  }\n\n  spawnMonster() {\n    const randomEnemy =\n      enemyData.enemies[Math.floor(Math.random() * enemyData.enemies.length)];\n    const location = this.pickRandomLocation();\n    const monster = new MonsterModel(\n      location[0],\n      location[1],\n      randomEnemy.goldValue, // gold value\n      `monster-${v4()}`,\n      randomEnemy.key, // key\n      randomEnemy.healthValue, // health value\n      randomEnemy.attackValue, // attack value\n      randomEnemy.expValue, // exp value\n      3000 //timer\n    );\n    this.addMonster(monster.id, monster);\n  }\n\n  addMonster(monsterId, monster) {\n    this.monsters[monsterId] = monster;\n    this.io.emit(\"monsterSpawned\", monster);\n  }\n\n  deleteMonster(monsterId) {\n    delete this.monsters[monsterId];\n    this.io.emit(\"monsterRemoved\", monsterId);\n  }\n\n  addLocation(x, y) {\n    this.monsterLocations.push([x, y]);\n  }\n\n  getMonsterList() {\n    return this.monsters;\n  }\n\n  getMonster(monsterId) {\n    return this.monsters[monsterId];\n  }\n  getMonsterLocationList() {\n    return this.monsterLocations;\n  }\n\n  _movement(monster) {\n    monster.move();\n    this.io.emit(\"monsterMovement\", monster);\n  }\n}"],"mappings":";;;;;;;;;;AAAA,IAAAA,aAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,SAAA,GAAAC,uBAAA,CAAAF,OAAA;AACA,IAAAG,KAAA,GAAAH,OAAA;AAA0B,SAAAI,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,yBAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAH,wBAAAG,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,gBAAAK,OAAA,CAAAL,CAAA,0BAAAA,CAAA,sBAAAA,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,cAAAR,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AAAA,IAELW,iBAAiB,GAAAC,OAAA;EACpC,SAAAD,kBAAYE,EAAE,EAAEC,SAAS,EAAE;IAAA,IAAAC,gBAAA,mBAAAJ,iBAAA;IACzB,IAAI,CAACK,QAAQ,GAAG,CAAC,CAAC;IAClB,IAAI,CAACC,gBAAgB,GAAGH,SAAS;IACjC,IAAI,CAACD,EAAE,GAAGA,EAAE;IAEZ,IAAI,CAACK,UAAU,CAAC,CAAC;IACjB,IAAI,CAACC,IAAI,CAAC,CAAC;EACb;EAAC,WAAAC,aAAA,aAAAT,iBAAA;IAAAU,GAAA;IAAAC,KAAA,EAED,SAAAH,KAAA,EAAO;MACL,IAAI,CAACI,MAAM,CAAC,CAAC;IACf;EAAC;IAAAF,GAAA;IAAAC,KAAA,EAED,SAAAE,oBAAoBC,MAAM,EAAE;MAAA,IAAAC,KAAA;MAC1B,OAAOD,MAAM,CAACE,EAAE,CAAC,YAAY,EAAE,UAACC,SAAS,EAAEC,YAAY,EAAEC,QAAQ,EAAK;QACpE,IAAI,CAACJ,KAAI,CAACV,QAAQ,CAACY,SAAS,CAAC,EAAE;QAC/B,IAAMG,OAAO,GAAGL,KAAI,CAACV,QAAQ,CAACY,SAAS,CAAC;QACxC,IAAQI,GAAG,GAAKD,OAAO,CAAfC,GAAG;QACX,IAAMC,iBAAiB,GAAGJ,YAAY;QACtCE,OAAO,CAACG,UAAU,CAACD,iBAAiB,CAAC;QAErC,IAAIF,OAAO,CAACI,MAAM,IAAI,CAAC,EAAE;UACvBV,MAAM,CAACW,IAAI,CAAC,gBAAgB,EAAEN,QAAQ,EAAEE,GAAG,CAAC;UAE5CN,KAAI,CAACW,aAAa,CAACN,OAAO,CAACO,EAAE,CAAC;QAChC,CAAC,MAAM;UACLb,MAAM,CAACW,IAAI,CAAC,qBAAqB,EAAER,SAAS,EAAEG,OAAO,CAACI,MAAM,CAAC;QAC/D;MACF,CAAC,CAAC;IACJ;EAAC;IAAAd,GAAA;IAAAC,KAAA,EAED,SAAAC,OAAA,EAAS;MAAA,IAAAgB,MAAA;MACPC,WAAW,CAAC,YAAM;QAChBrC,MAAM,CAACsC,IAAI,CAACF,MAAI,CAACvB,QAAQ,CAAC,CAAC0B,OAAO,CAAC,UAACJ,EAAE,EAAK;UACzC,IAAI,CAACC,MAAI,CAACvB,QAAQ,CAACsB,EAAE,CAAC,EAAE;UACxBC,MAAI,CAACI,SAAS,CAACJ,MAAI,CAACvB,QAAQ,CAACsB,EAAE,CAAC,CAAC;QACnC,CAAC,CAAC;MACJ,CAAC,EAAE,IAAI,CAAC;IACV;EAAC;IAAAjB,GAAA;IAAAC,KAAA,EAED,SAAAJ,WAAA,EAAa;MAAA,IAAA0B,MAAA;MACXJ,WAAW,CAAC,YAAM;QAChB,IAAIrC,MAAM,CAACsC,IAAI,CAACG,MAAI,CAAC5B,QAAQ,CAAC,CAAC6B,MAAM,IAAI,CAAC,EAAE;UAC1CD,MAAI,CAACE,YAAY,CAAC,CAAC;QACrB;MACF,CAAC,EAAE,IAAI,CAAC;IACV;EAAC;IAAAzB,GAAA;IAAAC,KAAA,EAED,SAAAyB,mBAAA,EAAqB;MACnB,IAAMC,QAAQ,GACZ,IAAI,CAAC/B,gBAAgB,CACnBgC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,GAAG,IAAI,CAAClC,gBAAgB,CAAC4B,MAAM,CAAC,CACzD;MAEH,IAAI,IAAI,CAAC7B,QAAQ,CAAC6B,MAAM,GAAG,CAAC,EAAE;QAC5B,IAAMO,eAAe,GAAG,IAAI,CAACpC,QAAQ,CAACqC,IAAI,CAAC,UAACC,GAAG,EAAK;UAClD,IAAIA,GAAG,CAACC,CAAC,KAAKP,QAAQ,CAAC,CAAC,CAAC,IAAIM,GAAG,CAACE,CAAC,KAAKR,QAAQ,CAAC,CAAC,CAAC,EAAE;YAClD,OAAO,IAAI;UACb;UACA,OAAO,KAAK;QACd,CAAC,CAAC;QAEF,IAAII,eAAe,EAAE,OAAO,IAAI,CAACL,kBAAkB,CAAC,CAAC;QACrD,OAAOC,QAAQ,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC;MAC/B;MACA,OAAOA,QAAQ,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC;IAC/B;EAAC;IAAA3B,GAAA;IAAAC,KAAA,EAED,SAAAwB,aAAA,EAAe;MACb,IAAMW,WAAW,GACfrE,SAAS,CAACsE,OAAO,CAACT,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,GAAG/D,SAAS,CAACsE,OAAO,CAACb,MAAM,CAAC,CAAC;MACzE,IAAMG,QAAQ,GAAG,IAAI,CAACD,kBAAkB,CAAC,CAAC;MAC1C,IAAMhB,OAAO,GAAG,IAAI4B,wBAAY,CAC9BX,QAAQ,CAAC,CAAC,CAAC,EACXA,QAAQ,CAAC,CAAC,CAAC,EACXS,WAAW,CAACG,SAAS,EAAE;MAAA,WAAAC,MAAA,CACZ,IAAAC,QAAE,EAAC,CAAC,GACfL,WAAW,CAACpC,GAAG;MAAE;MACjBoC,WAAW,CAACM,WAAW;MAAE;MACzBN,WAAW,CAACO,WAAW;MAAE;MACzBP,WAAW,CAACQ,QAAQ;MAAE;MACtB,IAAI,CAAC;MACP,CAAC;MACD,IAAI,CAACC,UAAU,CAACnC,OAAO,CAACO,EAAE,EAAEP,OAAO,CAAC;IACtC;EAAC;IAAAV,GAAA;IAAAC,KAAA,EAED,SAAA4C,WAAWtC,SAAS,EAAEG,OAAO,EAAE;MAC7B,IAAI,CAACf,QAAQ,CAACY,SAAS,CAAC,GAAGG,OAAO;MAClC,IAAI,CAAClB,EAAE,CAACuB,IAAI,CAAC,gBAAgB,EAAEL,OAAO,CAAC;IACzC;EAAC;IAAAV,GAAA;IAAAC,KAAA,EAED,SAAAe,cAAcT,SAAS,EAAE;MACvB,OAAO,IAAI,CAACZ,QAAQ,CAACY,SAAS,CAAC;MAC/B,IAAI,CAACf,EAAE,CAACuB,IAAI,CAAC,gBAAgB,EAAER,SAAS,CAAC;IAC3C;EAAC;IAAAP,GAAA;IAAAC,KAAA,EAED,SAAA6C,YAAYZ,CAAC,EAAEC,CAAC,EAAE;MAChB,IAAI,CAACvC,gBAAgB,CAACmD,IAAI,CAAC,CAACb,CAAC,EAAEC,CAAC,CAAC,CAAC;IACpC;EAAC;IAAAnC,GAAA;IAAAC,KAAA,EAED,SAAA+C,eAAA,EAAiB;MACf,OAAO,IAAI,CAACrD,QAAQ;IACtB;EAAC;IAAAK,GAAA;IAAAC,KAAA,EAED,SAAAgD,WAAW1C,SAAS,EAAE;MACpB,OAAO,IAAI,CAACZ,QAAQ,CAACY,SAAS,CAAC;IACjC;EAAC;IAAAP,GAAA;IAAAC,KAAA,EACD,SAAAiD,uBAAA,EAAyB;MACvB,OAAO,IAAI,CAACtD,gBAAgB;IAC9B;EAAC;IAAAI,GAAA;IAAAC,KAAA,EAED,SAAAqB,UAAUZ,OAAO,EAAE;MACjBA,OAAO,CAACyC,IAAI,CAAC,CAAC;MACd,IAAI,CAAC3D,EAAE,CAACuB,IAAI,CAAC,iBAAiB,EAAEL,OAAO,CAAC;IAC1C;EAAC;AAAA","ignoreList":[]}